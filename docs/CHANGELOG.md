# 更新日志

## [2.3.0] - 2026-02-12

### Phase 3: 教会稳固度评价系统

#### 新增
- **教会稳固度评价系统**：
  - 4维度评价：
    - 📚 根基：基于测验得分计算（满分100）
    - 👥 门徒：基于转化城市数+福音饱和度计算
    - 📖 长老：基于经文收藏数量+使用次数计算
    - ✊ 忍耐：基于最终信念值+禁食祷告经历计算
  - `GameData.churchHealthSystem` 统一管理评价逻辑
  - 实时计算总体稳固度（四维平均分）

- **4种结局等级**：
  - 🏆 使徒级 (80-100分)："你建立了7个稳固的教会，成为外邦人的光"
  - ⭐ 宣教士级 (60-79分)："你的足迹遍布加拉太，多人信了主"
  - 📖 门徒级 (40-59分)："你完成了旅程，但还有更多要学习"
  - 🏃 逃遁级 (0-39分)："在逼迫中逃离，需要重新得力"
  - 每个等级配有独特的徽章、颜色、描述和评价语

- **评价可视化界面**：
  - 华丽的评价结果展示页面
  - 总体评分大字显示（带颜色等级）
  - 四维度进度条可视化（带颜色标识）
  - 详细评价：根据各维度表现生成个性化评语
  - 成就系统：特殊组合解锁额外评价（如"卓越的神学家"）
  - 成长建议：针对最弱维度提供改进建议

- **禁食祷告经历追踪**：
  - 新增 `GameState.fastingExperience` 字段
  - 每次完成禁食祷告自动+1
  - 用于"忍耐"维度评价计算

#### 改动
- 重写 `showCompletionScreen` 函数，延迟显示评价界面
- 新增 `showChurchHealthEvaluation` 函数创建评价弹窗
- 新增 `adjustColor` 辅助函数调整颜色亮度
- 更新 `completeFastingPrayer` 记录禁食经历
- 更新保存/加载/清空函数支持 `fastingExperience` 字段
- 完成界面统计数据更新：显示转化城市数、平均福音饱和度
- 版本号升级至2.3

#### 影响
✓ 从"答题通关"转变为"建立教会"的核心目标
✓ 多维度评价增加重玩价值
✓ 个性化反馈帮助玩家了解成长方向
✓ 通关后有强烈成就感和反馈

---

## [2.2.0] - 2026-02-12

### Phase 2: 福音饱和度系统 + 开发文档

#### 新增
- **福音饱和度系统**：
  - 经文效果可增加城市福音饱和度（0-100%）
  - 5个等级：刚刚起步→初有果效→信徒增长→教会稳固→福音广传
  - 饱和度效果：降低敌人抵抗力、减少负面事件、增加经文对决伤害
  - `GameData.gospelSaturationSystem` 管理饱和度逻辑

- **动态难度算法增强**：
  - 敌人抵抗力根据福音饱和度降低（最高降低30%）
  - 旅行事件概率受饱和度影响（饱和度高→负面事件减少）
  - 经文对决胜利后增加城市饱和度奖励

- **城市百科卡片UI**：
  - 点击城市显示详细信息弹窗
  - 展示：福音饱和度进度条（带颜色等级）、城市特性（民性/敌对等级/宗教背景）
  - 民俗百科：地理位置、风俗习惯、历史背景、宣教挑战
  - 提供"进入城市"和"返回地图"按钮

- **开发文档**：
  - `docs/DESIGN.md`：完整设计文档（设计哲学、系统架构、重构历程）
  - `docs/CHANGELOG.md`：版本更新日志

#### 改动
- 更新 `applyVerseEffects` 支持福音饱和度效果
- 更新 `initScriptureDebate` 记录城市key并显示饱和度信息
- 更新 `executeScriptureDebateTurn` 胜利时增加福音饱和度
- 更新 `triggerTravelEvent` 和 `showTravelEventModal` 显示饱和度影响
- 修改 `handleCityClick` 先显示百科卡片再进入
- 保存系统新增 `citySaturation` 字段
- 版本号升级至2.2

---

## [2.1.0] - 2026-02-12

### Phase 1: 经文武器化重构

#### 新增
- **经文装备系统**：13段经文重构为12种属灵装备类型
  - 呼召、预备、权柄、审判、讲道、福音、观察、神迹、警戒、纠正、逼迫、复活、劝勉
  - 每段经文定义：装备类型、能力效果、适用场景、力量值、使用限制
  - 经文使用追踪系统（消耗型经文限制使用次数）

- **经文对决系统**：完全替换原有技能战斗
  - 玩家从收藏的经文中选择最适合的作为论据
  - 经文类型匹配敌人弱点造成1.5倍伤害
  - 无经文时只能凭自己回应（基础伤害低且消耗信念）
  - 卡片式经文选择UI，显示效果预览

- **城市民俗百科**：为7个城市添加深度信息
  - 福音饱和度字段 (gospel_saturation)
  - 城市特性：民性、敌对等级、宗教背景
  - 民俗百科：地理位置、风俗习惯、历史背景、宣教挑战

#### 改动
- 重构 `GameData.verses` 数据结构，添加装备属性
- 重构对决逻辑，移除技能按钮，改为经文选择
- 优化保存系统，新增 `verseUsage` 字段追踪经文使用
- UI优化：经文卡片显示类型图标、效果标签、剩余次数

#### 技术细节
- 动态难度算法保持：D = S + σ
- 保存系统兼容旧版本（自动迁移）
- 新增 `canUseVerse()`, `useVerse()`, `getAvailableVersesForScene()` 等函数

---

## [2.0.0] - 2026-02-12

### 核心玩法重构

#### 新增
- **资源管理系统**：
  - 信念(Faith)：生命值，归零触发禁食祷告
  - 供给(Supplies)：旅行消耗
  - 影响力(Influence)：解锁选项、应对事件

- **旅行事件系统**：城市间移动触发随机事件
  - 顺风顺水、小风浪、海上风暴、路遇强盗、船只失事
  - 动态概率算法：技能越高负面事件概率越低

- **属灵争战系统**（后被经文对决替换）：
  - 辩论、神迹、忍耐三个技能
  - 回合制战斗，消耗资源降低敌人阻力值

- **禁食祷告复活机制**：
  - Faith归零时触发
  - 三种任务类型：背诵经文、恒切祷告、安静等候
  - 完成后恢复50信念+10供给

- **动态难度算法**：D ≈ S + σ
  - 根据玩家技能等级动态调整敌人属性
  - 保持心流体验

#### 改动
- 重构 `GameState` 添加资源、技能、战斗状态字段
- 重构 `handleChoice` 添加旅行事件触发
- 更新保存系统支持新数据结构
- 地图界面添加资源条显示

---

## [1.0.0] - 初始版本

### 基础功能
- 地图系统：7个城市节点
- 场景系统：对话、经文搜索、记忆游戏、解谜、测验
- 经文收藏系统
- 本地存档
- PWA支持

---

## 版本号规则

- **主版本号**：重大重构（如玩法机制改变）
- **次版本号**：新增功能或系统
- **修订号**：Bug修复或优化

